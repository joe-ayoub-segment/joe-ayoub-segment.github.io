<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">

<head>
    <title>Kitchen sink form</title>

    <script>
        
       var seg_matsmart = {
    addEmarsysIdsMiddleware: function({ payload, next, integrations }) {
            
        const urlParams = new URLSearchParams(window.location.search);
            
        let emarsys_id_1_name = 'emarsys_cid';
        let emarsys_id_2_name = 'emarsys_cuid';
        let emarsys_id_3_name = 'emarsys_puid';

        let emarsys_id_1 = urlParams.get(emarsys_id_1_name);
        let emarsys_id_2 = urlParams.get(emarsys_id_2_name);
        let emarsys_id_3 = urlParams.get(emarsys_id_3_name);

        let externalIds = (payload.obj.context && payload.obj.context.hasOwnProperty('externalIds')) ? payload.obj.context.externalIds : [];

        if(emarsys_id_1){            
            let removeIndex = externalId.map(function(item) { return item.type; }).indexOf(emarsys_id_1_name);
            if(removeIndex == -1)
                externalIds.splice(removeIndex, 1);

            externalIds.push({
                "collection": "users",
                "encoding": "none",
                "id": emarsys_id_1,
                "type": emarsys_id_1_name 
            })
        }

        if(emarsys_id_2){            
            let removeIndex = externalId.map(function(item) { return item.type; }).indexOf(emarsys_id_2_name);
            if(removeIndex == -1)
                externalIds.splice(removeIndex, 1);

            externalIds.push({
                "collection": "users",
                "encoding": "none",
                "id": emarsys_id_2,
                "type": emarsys_id_2_name 
            })
        }

        if(emarsys_id_3){            
            let removeIndex = externalId.map(function(item) { return item.type; }).indexOf(emarsys_id_3_name);
            if(removeIndex == -1)
                externalIds.splice(removeIndex, 1);

            externalIds.push({
                "collection": "users",
                "encoding": "none",
                "id": emarsys_id_3,
                "type": emarsys_id_3_name 
            })
        }

        payload.obj.context.externalIds = externalIds;

        next(payload);
    },
    fireEventFromQuerystring: function(){
        const urlParams = new URLSearchParams(window.location.search);
        let eventName = urlParams.get('event');
        if(eventName && eventName.length > 0)
            analytics.track(eventName);
    }
}

!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"];analytics.factory=function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e);analytics.push(t);return analytics}};for(var e=0;e<analytics.methods.length;e++){var key=analytics.methods[e];analytics[key]=analytics.factory(key)}analytics.load=function(key,e){var t=document.createElement("script");t.type="text/javascript";t.async=!0;t.src="https://cdn.segment.com/analytics.js/v1/" + key + "/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);analytics._loadOptions=e};analytics.SNIPPET_VERSION="4.13.1";
    analytics.addSourceMiddleware(seg_matsmart.addEmarsysIdsMiddleware);
    analytics.load('f0mkFrd38lR8LW97t73odW9VkiQP532m');
    seg_matsmart.fireEventFromQuerystring();
}}();
        
    </script>

</head>

<body>

  <p>This is an empty page. Page will fire an Email Clicked track event if correct querystring values provided in URL</p>

</body>

</html>
